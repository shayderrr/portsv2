<!DOCTYPE html>
<html lang=en>

<head>
    <meta charset="utf-8">
    <title>Flash Loader | Ruffle</title>
    <meta name="robots" content="noindex,nofollow">
    <style>
        * {
            -webkit-touch-callout: none;
            -webkit-tap-highlight-color: transparent;
            -moz-user-select: -moz-none;
            -webkit-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        @font-face {
            font-family: frivFont;
            font-display: swap;
            src: url(/z/assets/fonts/frivFont.woff);
        }

        html,
        body {
            overflow: hidden;
            background: indigo;
            margin: 0;
            text-align: center;
            height: 100vh;
        }

        h1 {
            text-align: center;
            margin-top: 1vh;
            font-size: 5vw;
            color: #fff;
            text-shadow: 6px 6px 0 rgba(0, 0, 0, .3);
        }

        #outerLogoContainer {
            z-index: 999;
            position: absolute;
            opacity: 0;
            top: 200vh;
            height: 100%;
            width: 100%;
            background-color: indigo;
            background-image: linear-gradient(175deg, indigo, indigo, #300050, indigo, indigo);
            animation: outerLogoContainerFadeOut 6s linear forwards;
        }

        #innerLogoContainer {
            margin: 0;
            position: absolute;
            top: 55%;
            transform: translateY(-50%);
        }

        #loadingLogo {
            width: 100vw;
            height: 50vh;
            max-height: 50vh;
            background-image: url("friv-logo-classic-loader-min.svg");
            background-size: contain;
            background-position: center center;
            background-repeat: no-repeat;
        }

        @keyframes outerLogoContainerFadeOut {
            0% {
                opacity: 1;
                top: 0;
            }

            80% {
                opacity: 1;
            }

            98% {
                top: 0;
                opacity: 0;
            }

            99% {
                top: 200vh;
            }

            100% {
                top: 200vh;
                display: none;

            }
        }


        /* TOUCH-ADDITION-PART1-START-ZZZ */

        /* General touch control container - HIDDEN BY DEFAULT */
        #touchControlsOverlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 100;
            /* Hides on desktop/non-touch devices */
            display: none;

            /* iOS Fix: Try to prevent edge-swipes in the control area */
            touch-action: none;

            opacity: 0;

            animation: touchbuttonFadeIn 3s 5s linear forwards;
        }

        @keyframes touchbuttonFadeIn {
            0% {
                opacity: 0;
            }

            100% {
                opacity: 1;
            }
        }

        /* ðŸŽ¯ Desktop Detection: Show overlay ONLY on touch-enabled devices */
        /* Checks for a coarse pointer (finger/stylus) AND no hover capability */
        @media (pointer: coarse) and (hover: none) {
            #touchControlsOverlay {
                display: block;
            }
        }

        /* Base style for all dynamic touch buttons */
        .touchButton {
            position: absolute;
            z-index: 101;
            border: 0.3vmax solid white;
            border-radius: 3vmin;
            cursor: pointer;
            pointer-events: auto;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-family: frivFont, arial, helvetica, sans-serif;
            font-size: 5vmin;
            text-shadow: 2px 2px 2px black;
            /* background-color: rgba(0, 0, 0, .2); */
            background-color: black;
            opacity: 0.15;

            /* iOS Fix: Ensure button touch is handled by the app */
            touch-action: none;
            -webkit-overflow-scrolling: auto;
        }

        /* TOUCH-ADDITION-PART1-END-ZZZ */
    </style>
</head>

<body>

    <div id=outerLogoContainer>
        <div id=innerLogoContainer>
            <div id=loadingLogo></div>
            <h1 id=underLogoText>&nbsp;</h1>
        </div>
    </div>

    <div id=container></div>

    <div id="touchControlsOverlay">
    </div>

    <script src="/z/assets/scripts/ruffle-251020/ruffle.js"></script>

    <script>
        // --- Utility Functions ---
        // 1. iOS Detection
        const isIOS = () => {
            return /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
        };
        // 2. CSS Style Value Parsing
        const parseVw = (styleString, property = 'left') => {
            const match = styleString.match(new RegExp(`${property}:\\s*(\\d+(\\.\\d+)?)\\s*vw;`));
            return match ? parseFloat(match[1]) : null;
        };

        // --- Core Variables ---
        var debug = false;

        var passedVars = (window.location.search.substring(1));
        var gameArray = passedVars.split("-");
        var dirName = gameArray[0];
        var gameName = gameArray[1];
        var flashX = gameArray[2];
        var flashY = gameArray[3];
        var gameRatio = (flashX / flashY).toFixed(4);

        if (gameName == "!") {
            gameName = dirName;
        }

        if (debug) {
            //dirName = "badicecream3";
            // Spoof / temporarily force display block for desktop debugging (overrides CSS 'display: none')
            window.addEventListener("DOMContentLoaded", () => {
                const overlay = document.getElementById('touchControlsOverlay');
                if (overlay) {
                    overlay.style.display = 'block';
                }
            });
        }

        window.RufflePlayer = window.RufflePlayer || {};

        const LRUDS = [
            { id: 'leftButton', key: 'ArrowLeft', code: 'ArrowLeft', text: 'â†', style: 'left: 1vw; bottom: 1vw; width: 12vw; height: 12vw;' },
            { id: 'rightButton', key: 'ArrowRight', code: 'ArrowRight', text: 'â†’', style: 'left: 14vw; bottom: 1vw; width: 12vw; height: 12vw;' },
            { id: 'upButton', key: 'ArrowUp', code: 'ArrowUp', text: 'â†‘', style: 'right: 1vw; bottom: 14vw; width: 12vw; height: 12vw;' },
            { id: 'downButton', key: 'ArrowDown', code: 'ArrowDown', text: 'â†“', style: 'right: 1vw; bottom: 1vw; width: 12vw; height: 12vw;' },
            { id: 'spacebar', key: ' ', code: 'Space', text: 'SPACE', style: 'right: 14vw; bottom: 1vw; width: 18vw; height: 12vw;' }
        ];

        const LRUS = [
            { id: 'leftButton', key: 'ArrowLeft', code: 'ArrowLeft', text: 'â†', style: 'left: 1vw; bottom: 1vw; width: 12vw; height: 12vw;' },
            { id: 'rightButton', key: 'ArrowRight', code: 'ArrowRight', text: 'â†’', style: 'left: 14vw; bottom: 1vw; width: 12vw; height: 12vw;' },
            { id: 'upButton', key: 'ArrowUp', code: 'ArrowUp', text: 'â†‘', style: 'right: 1vw; bottom: 14vw; width: 12vw; height: 12vw;' },
            { id: 'spacebar', key: ' ', code: 'Space', text: 'SPACE', style: 'right: 1vw; bottom: 1vw; width: 18vw; height: 12vw;' }
        ];

        const LRUD = [
            // D-Pad Left/Right (on the left)
            { id: 'leftButton', key: 'ArrowLeft', code: 'ArrowLeft', text: 'â†', style: 'left: 1vw; bottom: 1vw; width: 12vw; height: 12vw;' },
            { id: 'rightButton', key: 'ArrowRight', code: 'ArrowRight', text: 'â†’', style: 'left: 14vw; bottom: 1vw; width: 12vw; height: 12vw;' },
            { id: 'upButton', key: 'ArrowUp', code: 'ArrowUp', text: 'â†‘', style: 'right: 1vw; bottom: 14vw; width: 12vw; height: 12vw;' },
            { id: 'downButton', key: 'ArrowDown', code: 'ArrowDown', text: 'â†“', style: 'right: 1vw; bottom: 1vw; width: 12vw; height: 12vw;' },
        ];

        const LRS = [
            { id: 'leftButton', key: 'ArrowLeft', code: 'ArrowLeft', text: 'â†', style: 'left: 1vw; bottom: 1vw; width: 12vw; height: 12vw;' },
            { id: 'rightButton', key: 'ArrowRight', code: 'ArrowRight', text: 'â†’', style: 'left: 14vw; bottom: 1vw; width: 12vw; height: 12vw;' },
            { id: 'spacebar', key: ' ', code: 'Space', text: 'SPACE', style: 'right: 1vw; bottom: 1vw; width: 18vw; height: 12vw;' }
        ];

        const LRU = [
            { id: 'leftButton', key: 'ArrowLeft', code: 'ArrowLeft', text: 'â†', style: 'left: 1vw; bottom: 1vw; width: 12vw; height: 12vw;' },
            { id: 'rightButton', key: 'ArrowRight', code: 'ArrowRight', text: 'â†’', style: 'left: 14vw; bottom: 1vw; width: 12vw; height: 12vw;' },
            { id: 'upButton', key: 'ArrowUp', code: 'ArrowUp', text: 'â†‘', style: 'right: 1vw; bottom: 1vw; width: 12vw; height: 12vw;' },
        ];

        const LRUDSB = [
            { id: 'leftButton', key: 'ArrowLeft', code: 'ArrowLeft', text: 'â†', style: 'left: 1vw; bottom: 1vw; width: 12vw; height: 12vw;' },
            { id: 'rightButton', key: 'ArrowRight', code: 'ArrowRight', text: 'â†’', style: 'left: 14vw; bottom: 1vw; width: 12vw; height: 12vw;' },
            { id: 'upButton', key: 'ArrowUp', code: 'ArrowUp', text: 'â†‘', style: 'right: 1vw; bottom: 14vw; width: 12vw; height: 12vw;' },
            { id: 'downButton', key: 'ArrowDown', code: 'ArrowDown', text: 'â†“', style: 'right: 1vw; bottom: 1vw; width: 12vw; height: 12vw;' },
            { id: 'spacebar', key: ' ', code: 'Space', text: 'SPACE', style: 'right: 14vw; bottom: 1vw; width: 18vw; height: 12vw;' },
            { id: 'kButton', key: 'b', code: 'KeyB', text: 'B', style: 'left: 1vw; bottom: 14vw; width: 12vw; height: 12vw;' },
        ];

        const LRUDP = [
            { id: 'leftButton', key: 'ArrowLeft', code: 'ArrowLeft', text: 'â†', style: 'left: 1vw; bottom: 1vw; width: 12vw; height: 12vw;' },
            { id: 'rightButton', key: 'ArrowRight', code: 'ArrowRight', text: 'â†’', style: 'left: 14vw; bottom: 1vw; width: 12vw; height: 12vw;' },
            { id: 'upButton', key: 'ArrowUp', code: 'ArrowUp', text: 'â†‘', style: 'right: 1vw; bottom: 14vw; width: 12vw; height: 12vw;' },
            { id: 'downButton', key: 'ArrowDown', code: 'ArrowDown', text: 'â†“', style: 'right: 1vw; bottom: 1vw; width: 12vw; height: 12vw;' },
            { id: 'pButton', key: 'p', code: 'KeyP', text: 'P', style: 'right: 1vw; bottom: 27vw; width: 12vw; height: 12vw;' },
        ];

        const LRUDSS = [
            { id: 'leftButton', key: 'ArrowLeft', code: 'ArrowLeft', text: 'â†', style: 'left: 1vw; bottom: 1vw; width: 12vw; height: 12vw;' },
            { id: 'rightButton', key: 'ArrowRight', code: 'ArrowRight', text: 'â†’', style: 'left: 14vw; bottom: 1vw; width: 12vw; height: 12vw;' },
            { id: 'upButton', key: 'ArrowUp', code: 'ArrowUp', text: 'â†‘', style: 'right: 1vw; bottom: 14vw; width: 12vw; height: 8vw;' },
            { id: 'downButton', key: 'ArrowDown', code: 'ArrowDown', text: 'â†“', style: 'right: 1vw; bottom: 1vw; width: 12vw; height: 12vw;' },
            { id: 'spacebar', key: ' ', code: 'Space', text: 'SPACE', style: 'right: 1vw; bottom: 23vw; width: 12vw; height: 6vw;' },
            { id: 'sButton', key: 's', code: 'KeyS', text: 'S', style: 'right: 14vw; bottom: 1vw; width: 12vw; height: 12vw;' },
            { id: 'qButton', key: 'q', code: 'KeyQ', text: 'Q', style: 'left: 1vw; bottom: 14vw; width: 12vw; height: 6vw;' }
        ];



        // GAME-SPECIFIC TOUCH CONTROL CONFIGURATION
        const GAME_TOUCH_CONFIG = {

            'angelico': {
                buttons: LRUDS
            },

            'bigheadfootball': {
                buttons: LRUS
            },

            // game not ready yet - fails on latest ruffle
            //'bloxorz': {
            //    buttons: LRUD
            //},

            'caveman': {
                buttons: LRUDS
            },

            'checkpoint': {
                buttons: [
                    { id: 'leftButton', key: 'ArrowLeft', code: 'ArrowLeft', text: 'â†', style: 'left: 1vw; bottom: 15vw; width: 12vw; height: 12vw;' },
                    { id: 'rightButton', key: 'ArrowRight', code: 'ArrowRight', text: 'â†’', style: 'left: 14vw; bottom: 15vw; width: 12vw; height: 12vw;' },
                    { id: 'upButton', key: 'ArrowUp', code: 'ArrowUp', text: 'â†‘', style: 'right: 1vw; bottom: 14vw; width: 12vw; height: 12vw;' },
                    { id: 'downButton', key: 'ArrowDown', code: 'ArrowDown', text: 'â†“', style: 'right: 1vw; bottom: 1vw; width: 12vw; height: 12vw;' },
                    { id: 'pButton', key: 'p', code: 'KeyP', text: 'P', style: 'right: 1vw; bottom: 27vw; width: 12vw; height: 6vw;' }
                ]
            },

            'cubob': {
                buttons: LRS
            },

            'badicecream': {
                offsetY_vh: -12,
                buttons: LRUDS
            },

            'badicecream2': {
                offsetY_vh: -12,
                buttons: LRUDS
            },

            'badicecream3': {
                offsetY_vh: -12,
                buttons: LRUDS
            },

            'dieselanddeath': {
                buttons: [
                    { id: 'leftButton', key: 'ArrowLeft', code: 'ArrowLeft', text: 'â†', style: 'left: 1vw; bottom: 1vw; width: 12vw; height: 12vw;' },
                    { id: 'rightButton', key: 'ArrowRight', code: 'ArrowRight', text: 'â†’', style: 'left: 14vw; bottom: 1vw; width: 12vw; height: 12vw;' },
                    { id: 'upButton', key: 'ArrowUp', code: 'ArrowUp', text: 'â†‘', style: 'right: 1vw; bottom: 14vw; width: 12vw; height: 12vw;' },
                    { id: 'spacebar', key: ' ', code: 'Space', text: 'SPACE', style: 'right: 1vw; bottom: 1vw; width: 12vw; height: 12vw;' }
                ]
            },

            'extremepamplona': {
                buttons: LRS
            },

            'fancypantsadventure': {
                buttons: LRUDSS
            },

            'fancypantsadventure2': {
                buttons: LRUDSS
            },

            'farafalla': {
                buttons: LRS
            },

            'freegear': {
                buttons: [
                    { id: 'leftButton', key: 'ArrowLeft', code: 'ArrowLeft', text: 'â†', style: 'left: 1vw; bottom: 1vw; width: 12vw; height: 12vw;' },
                    { id: 'rightButton', key: 'ArrowRight', code: 'ArrowRight', text: 'â†’', style: 'left: 14vw; bottom: 1vw; width: 12vw; height: 12vw;' },
                    { id: 'upButton', key: 'ArrowUp', code: 'ArrowUp', text: 'â†‘', style: 'right: 1vw; bottom: 14vw; width: 12vw; height: 12vw;' },
                    { id: 'downButton', key: 'ArrowDown', code: 'ArrowDown', text: 'â†“', style: 'right: 1vw; bottom: 1vw; width: 12vw; height: 12vw;' },
                    { id: 'pButton', key: 'p', code: 'KeyP', text: 'P', style: 'right: 1vw; bottom: 27vw; width: 5.5vw; height: 8vw;' },
                    { id: 'qButton', key: 'q', code: 'KeyQ', text: 'Q', style: 'right: 7.5vw; bottom: 27vw; width: 5.5vw; height: 8vw;' },
                    { id: 'zButton', key: 'z', code: 'KeyZ', text: 'Z', style: 'left: 1vw; bottom: 32vw; width: 12vw; height: 8vw;' },
                    { id: 'xButton', key: 'x', code: 'KeyX', text: 'X', style: 'left: 1vw; bottom: 23vw; width: 12vw; height: 8vw;' },
                    { id: 'cButton', key: 'c', code: 'KeyC', text: 'C', style: 'left: 1vw; bottom: 14vw; width: 12vw; height: 8vw;' }
                ]
            },

            'frizzlefrazdeluxe': {
                buttons: LRUD
            },

            'hauntthehouse': {
                buttons: LRUDS
            },

            'jackfrost': {
                buttons: LRUD
            },

            'jellydadhero': {
                buttons: [
                    { id: 'leftButton', key: 'ArrowLeft', code: 'ArrowLeft', text: 'â†', style: 'left: 1vw; bottom: 6vw; width: 12vw; height: 12vw;' },
                    { id: 'rightButton', key: 'ArrowRight', code: 'ArrowRight', text: 'â†’', style: 'left: 14vw; bottom: 6vw; width: 12vw; height: 12vw;' },
                    { id: 'upButton', key: 'ArrowUp', code: 'ArrowUp', text: 'â†‘', style: 'right: 1vw; bottom: 19vw; width: 12vw; height: 12vw;' },
                    { id: 'spacebar', key: ' ', code: 'Space', text: 'SPACE', style: 'right: 1vw; bottom: 6vw; width: 18vw; height: 12vw;' }
                ]
            },

            'kickbuttowski': {
                buttons: [
                    { id: 'leftButton', key: 'ArrowLeft', code: 'ArrowLeft', text: 'â†', style: 'right: 23vw; bottom: 1vw; width: 10vw; height: 12vw;' },
                    { id: 'rightButton', key: 'ArrowRight', code: 'ArrowRight', text: 'â†’', style: 'right: 1vw; bottom: 1vw; width: 10vw; height: 12vw;' },
                    { id: 'upButton', key: 'ArrowUp', code: 'ArrowUp', text: 'â†‘', style: 'right: 12vw; bottom: 14vw; width: 10vw; height: 12vw;' },
                    { id: 'downButton', key: 'ArrowDown', code: 'ArrowDown', text: 'â†“', style: 'right: 12vw; bottom: 1vw; width: 10vw; height: 12vw;' },
                    { id: 'spacebar', key: ' ', code: 'Space', text: 'SPACE', style: 'left: 1vw; bottom: 1vw; width: 15vw; height: 12vw;' }
                ]
            },

            'lemonbreak': {
                buttons: LRUD
            },

            'pocketfighternova': {
                buttons: [
                    { id: 'wButton', key: 'w', code: 'KeyW', text: 'W', style: 'left: 12vw; bottom: 14vw; width: 10vw; height: 12vw;' },
                    { id: 'aButton', key: 'a', code: 'KeyA', text: 'A', style: 'left: 1vw; bottom: 1vw; width: 10vw; height: 12vw;' },
                    { id: 'sButton', key: 's', code: 'KeyS', text: 'S', style: 'left: 12vw; bottom: 1vw; width: 10vw; height: 12vw;' },
                    { id: 'dButton', key: 'd', code: 'KeyD', text: 'D', style: 'left: 23vw; bottom: 1vw; width: 10vw; height: 12vw;' },
                    { id: 'jButton', key: 'j', code: 'KeyJ', text: 'J', style: 'right: 23vw; bottom: 1vw; width: 10vw; height: 12vw;' },
                    { id: 'kButton', key: 'k', code: 'KeyK', text: 'K', style: 'right: 12vw; bottom: 1vw; width: 10vw; height: 12vw;' },
                    { id: 'lButton', key: 'l', code: 'KeyL', text: 'L', style: 'right: 1vw; bottom: 1vw; width: 10vw; height: 12vw;' },
                    { id: 'spacebar', key: ' ', code: 'Space', text: '_', style: 'right: 1vw; bottom: 14vw; width: 10vw; height: 12vw;' }
                ]
            },

            'pacxon': {
                buttons: LRUD
            },

            'pacxondeluxe': {
                buttons: LRUDP
            },

            'parkingmania': {
                buttons: LRUD
            },

            'powerpamplona': {
                buttons: LRS
            },

            'redball': {
                buttons: LRU
            },

            'rockyrider': {
                buttons: [
                    { id: 'leftButton', key: 'ArrowLeft', code: 'ArrowLeft', text: 'â†', style: 'left: 1vw; bottom: 1vw; width: 9vw; height: 12vw;' },
                    { id: 'rightButton', key: 'ArrowRight', code: 'ArrowRight', text: 'â†’', style: 'left: 11vw; bottom: 1vw; width: 9vw; height: 12vw;' },
                    { id: 'upButton', key: 'ArrowUp', code: 'ArrowUp', text: 'â†‘', style: 'right: 1vw; bottom: 14vw; width: 9vw; height: 12vw;' },
                    { id: 'downButton', key: 'ArrowDown', code: 'ArrowDown', text: 'â†“', style: 'right: 1vw; bottom: 1vw; width: 9vw; height: 12vw;' },
                    { id: 'spacebar', key: ' ', code: 'Space', text: 'SPACE', style: 'right: 11vw; bottom: 1vw; width: 14vw; height: 12vw;' },
                    { id: 'zButton', key: 'z', code: 'KeyZ', text: 'Z', style: 'left: 1vw; bottom: 14vw; width: 9vw; height: 12vw;' }
                ]
            },

            'shapeshifter': {
                buttons: LRUD
            },

            'shapeshifter2': {
                buttons: LRUD
            },

            'skyserpents': {
                buttons: LRUDS
            },
            // game softlocks on mobile nov 2025

            'squaremeal': {
                buttons: LRUDS
            },

            'steeldangers': {
                buttons: [
                    { id: 'leftButton', key: 'ArrowLeft', code: 'ArrowLeft', text: 'â†', style: 'left: 1vw; bottom: 5vw; width: 12vw; height: 12vw;' },
                    { id: 'rightButton', key: 'ArrowRight', code: 'ArrowRight', text: 'â†’', style: 'left: 14vw; bottom: 5vw; width: 12vw; height: 12vw;' },
                    { id: 'spacebar', key: ' ', code: 'Space', text: 'SPACE', style: 'right: 14vw; bottom: 5vw; width: 16vw; height: 12vw;' },
                    { id: 'upButton', key: 'ArrowUp', code: 'ArrowUp', text: 'â†‘', style: 'right: 1vw; bottom: 18vw; width: 12vw; height: 12vw;' },
                    { id: 'downButton', key: 'ArrowDown', code: 'ArrowDown', text: 'â†“', style: 'right: 1vw; bottom: 5vw; width: 12vw; height: 12vw;' },
                    { id: 'qButton', key: 'q', code: 'KeyQ', text: 'Q', style: 'left: 1vw; bottom: 18vw; width: 12vw; height: 8vw;' },
                    { id: 'eButton', key: 'e', code: 'KeyE', text: 'E', style: 'left: 1vw; bottom: 27vw; width: 12vw; height: 8vw;' },
                    { id: 'pButton', key: 'p', code: 'KeyP', text: 'P', style: 'right: 1vw; bottom: 31vw; width: 12vw; height: 8vw;' },
                    
                ]
            },

            'supermarioflash': {
                buttons: LRUDSB
            },

            'tastyplanetdinotime': {
                buttons: LRUDS
            },

            'toxic': {
                buttons: LRUDS
            },

            'twinshot': {
                buttons: LRUS
            },

            'twinshot2': {
                buttons: LRUS
            },

        };

        // --- NEW iOS Offset Logic ---
        /**
         * Checks if the user is on iOS and shifts the left-side buttons to avoid the back-swipe gesture.
         * @param {Array} originalButtons The configuration array of buttons.
         * @returns {Array} The modified button configuration array.
         */
        function getPlatformAdjustedButtons(originalButtons) {
            // Only apply the shift if we detect an iOS device
            if (true || !isIOS()) { //disabled any mods to iOS for now
                return originalButtons;
            }

            const iOS_SHIFT_VW = 5.0; // The desired extra buffer from the edge

            // Create a deep copy to avoid modifying the original config arrays
            const adjustedButtons = JSON.parse(JSON.stringify(originalButtons));

            adjustedButtons.forEach(button => {
                // Check if the button has a 'left' position style
                if (button.style && button.style.includes('left:')) {
                    const currentLeftVw = parseVw(button.style, 'left');

                    if (currentLeftVw !== null) {
                        // Calculate new left position
                        const newLeftVw = currentLeftVw + iOS_SHIFT_VW;

                        // Replace the old 'left' value with the new one
                        const oldLeftStyle = `left: ${currentLeftVw}vw;`;
                        const newLeftStyle = `left: ${newLeftVw}vw;`;

                        button.style = button.style.replace(oldLeftStyle, newLeftStyle);
                    }
                }
            });

            return adjustedButtons;
        }


        // Ruffle config setup (retained from original)
        window.RufflePlayer.config = {
            "publicPath": undefined,
            "polyfills": true,
            "autoplay": "auto",
            "unmuteOverlay": "visible",
            "backgroundColor": null,
            "wmode": "window",
            "letterbox": "fullscreen",
            "warnOnUnsupportedContent": false,
            "contextMenu": "off",
            "showSwfDownload": false,
            "upgradeToHttps": window.location.protocol === "https:",
            "maxExecutionDuration": 15,
            "logLevel": "error",
            "base": null,
            "menu": false,
            "salign": "",
            "scale": "showAll",
            "quality": "high",
            "splashScreen": false,
            "preloader": true,
            "openUrlMode": "deny",
            "allowScriptAccess": false,
            "allowNetworking": "none",
        };

        // Existing game-specific ruffle config updates (retained from original)
        if (dirName == "scaryscavengerhunt") {
            window.RufflePlayer.config.base = "/z/games/scaryscavengerhunt/";
            console.log("base:" + window.RufflePlayer.config.base);
        }
        if (dirName == "scaryscavengerhunt2") {
            window.RufflePlayer.config.base = "/z/games/scaryscavengerhunt2/";
            console.log("base:" + window.RufflePlayer.config.base);
        }
        if (dirName.indexOf("powerpamplona") > -1) {
            window.RufflePlayer.config.base = "/z/games/powerpamplona/";
            console.log("base:" + window.RufflePlayer.config.base);
        }
        if (dirName.indexOf("extremepamplona") > -1) {
            window.RufflePlayer.config.base = "/z/games/extremepamplona/";
            console.log("base:" + window.RufflePlayer.config.base);
        }
        if (dirName.indexOf("chasm") > -1) {
            window.RufflePlayer.config.base = "/z/games/chasm/";
            console.log("base:" + window.RufflePlayer.config.base);
        }
        if (dirName.indexOf("zuma") > -1) {
            window.RufflePlayer.config.base = "/z/games/zuma/";
            console.log("base:" + window.RufflePlayer.config.base);
        }
        if (dirName.indexOf("hollyhobbie") > -1) {
            window.RufflePlayer.config.base = "/z/games/hollyhobbiedollhouse/";
            console.log("base:" + window.RufflePlayer.config.base);
        }
        if (dirName.indexOf("snowdriftland") > -1) {
            window.RufflePlayer.config.base = "/z/games/missioninsnowdriftland/";
            console.log("base:" + window.RufflePlayer.config.base);
        }
        if (dirName.indexOf("hallofthewild") > -1) {
            window.RufflePlayer.config.base = "/z/games/hallofthewild/";
            console.log("base:" + window.RufflePlayer.config.base);
        }
        if (dirName.indexOf("hallofthewild2") > -1) {
            window.RufflePlayer.config.base = "/z/games/hallofthewild2/";
            console.log("base:" + window.RufflePlayer.config.base);
        }
        if (dirName.indexOf("heist") > -1) {
            window.RufflePlayer.config.base = "/z/games/heist/";
            console.log("base:" + window.RufflePlayer.config.base);
        }
        if (dirName.indexOf("sarassuperspa") > -1) {
            window.RufflePlayer.config.base = "/z/games/sarassuperspa/core/";
            console.log("base:" + window.RufflePlayer.config.base);
        }
        if (dirName.indexOf("dentaladventure") > -1) {
            window.RufflePlayer.config.base = "/z/games/dentaladventure/";
            console.log("base:" + window.RufflePlayer.config.base);
        }
        if (dirName.indexOf("angelico") > -1) {
            window.RufflePlayer.config.base = "/z/games/angelico/";
            console.log("base:" + window.RufflePlayer.config.base);
        }
        if (dirName.indexOf("hoshisaga") > -1) {
            window.RufflePlayer.config.base = "/z/games/hoshisaga/";
            console.log("base:" + window.RufflePlayer.config.base);
        }
        if (dirName.indexOf("lemonbreak") > -1) {
            window.RufflePlayer.config.base = "/z/games/lemonbreak/";
            console.log("base:" + window.RufflePlayer.config.base);
        }

        window.addEventListener("DOMContentLoaded", () => {
            let ruffle = window.RufflePlayer.newest();
            let player = ruffle.createPlayer();
            let container = document.getElementById("container");
            container.appendChild(player);

            let loadString = "/z/games/" + dirName + "/" + gameName + ".swf";

            if (gameName.indexOf("frivMenuPhoenix") > -1) {
                window.RufflePlayer.config = {
                    autoplay: "on",
                };
                loadString = "/old/frivMenuPhoenix.swf";
            }

            player.load(loadString);

            // ðŸš€ Initialize Touch Controls based on game configuration
            initializeTouchControls(dirName);
        });

        // Retained scaling logic
        setInterval(function () {
            scaleGame();
        }, 999);

        window.addEventListener("resize", scaleGame);

        // Function remains outside of DOMContentLoaded listener
        function scaleGame() {
            const rufflePlayer = document.getElementsByTagName("ruffle-player")[0];
            if (!rufflePlayer) return; // Exit if player isn't loaded yet

            // Determine the vertical offset from the configuration
            const config = GAME_TOUCH_CONFIG[dirName] || {};
            const offsetY_vh = config.offsetY_vh || 0; // Defaults to 0 if not defined

            // Existing scaling logic (retained)
            rufflePlayer.style.height = "100vh";
            rufflePlayer.style.width = (gameRatio * 100) + "vh";
            rufflePlayer.style.boxShadow = "0 0 5vmin 1vmin black";
            rufflePlayer.style.marginTop = 0; // Resetting margin top

            rufflePlayer.focus();

            if (rufflePlayer.offsetWidth > window.innerWidth) {
                // Portrait/Mobile Mode Logic (Game is sized by width)
                rufflePlayer.style.width = "100vw";
                rufflePlayer.style.height = (100 / gameRatio) + "vw";

                // Calculate standard centering margin
                let centeringMargin = (window.innerHeight - rufflePlayer.offsetHeight) / 2;

                // APPLY OFFSET: Convert vh offset to pixels and adjust centeringMargin
                const offsetPx = (offsetY_vh / 100) * window.innerHeight;

                rufflePlayer.style.marginTop = (centeringMargin + offsetPx) + "px"; // Add the offset
            }
            // If the game is sized by height (desktop/landscape), we don't apply the shift 
            // to avoid shifting off the screen, we keep marginTop at 0.
        }


        // --- TOUCH CONTROL INITIALIZATION ---
        ////////////////////////////////

        function dispatchKeyEvent(key, code, type) {
            const event = new KeyboardEvent(type, {
                key: key,
                code: code,
                bubbles: true,
                cancelable: true
            });
            document.dispatchEvent(event);
        }

        function initializeTouchControls(currentDirName) {
            const baseConfig = GAME_TOUCH_CONFIG[currentDirName];
            const overlay = document.getElementById('touchControlsOverlay');

            if (!baseConfig || !baseConfig.buttons || baseConfig.buttons.length === 0) {
                return;
            }

            // ðŸ’¡ Apply iOS specific shift BEFORE creating buttons
            const config = {
                ...baseConfig,
                buttons: getPlatformAdjustedButtons(baseConfig.buttons)
            };

            const IDLE_OPACITY = '0.15';
            const ACTIVE_OPACITY = '0.4';

            // ðŸŒŸ Global Reset Function: Fixes "sticky buttons" ðŸŒŸ
            const resetAllButtons = () => {
                document.querySelectorAll('.touchButton.active-touch').forEach(btn => {
                    btn.style.opacity = IDLE_OPACITY;
                    btn.classList.remove('active-touch');
                });
            };

            // ðŸŽ¯ Global Listener: If any touch ends on the document, reset all button visuals.
            document.body.addEventListener('touchend', resetAllButtons);
            document.body.addEventListener('mouseup', resetAllButtons);


            config.buttons.forEach(buttonData => {
                const btn = document.createElement('div');
                btn.id = buttonData.id;
                btn.className = 'touchButton';
                btn.textContent = buttonData.text || '';

                // Start with the desired idle opacity (0.15)
                btn.style.opacity = IDLE_OPACITY;
                // Apply the calculated or original style (including the iOS shift if applied)
                btn.style.cssText = buttonData.style;

                const key = buttonData.key;
                const code = buttonData.code;

                // --- Shared Press Handler (Keydown + Visual Feedback) ---
                const handlePress = (e) => {
                    // ðŸ›‘ CRITICAL for iOS edge-swipe fix: prevent default browser/OS action
                    e.preventDefault();

                    btn.style.opacity = ACTIVE_OPACITY;
                    btn.classList.add('active-touch');
                    dispatchKeyEvent(key, code, 'keydown');
                };

                // --- Shared Release Handler (Keyup + Visual Reset) ---
                const handleRelease = (e) => {
                    e.preventDefault();

                    setTimeout(() => {
                        btn.style.opacity = IDLE_OPACITY;
                        btn.classList.remove('active-touch');
                    }, 50);

                    dispatchKeyEvent(key, code, 'keyup');
                };

                // Attach handlers
                btn.addEventListener('touchstart', handlePress);
                btn.addEventListener('touchend', handleRelease);
                btn.addEventListener('mousedown', handlePress);
                btn.addEventListener('mouseup', handleRelease);

                overlay.appendChild(btn);
            });

            // Prevents locking of controls if user clicks off the game
            document.getElementById('container').addEventListener('mousedown', (e) => { e.preventDefault(); });
            document.getElementById('container').addEventListener('mouseup', (e) => { e.preventDefault(); });
        }


    </script>

</body>

</html>