<!DOCTYPE html>
<!-- Ultimate Game Stash file--> 
<!-- For the regularly updating doc go to https://docs.google.com/document/d/1_FmH3BlSBQI7FGgAQL59-ZPe8eCxs35wel6JUyVaG8Q/ -->
<!-- shxyder -->
<html lang="en-us">
<head>
  <meta charset="utf-8">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <style>
    html,
    body {
      background-color: black;
      width: 100%;
      height: 100%;
      overflow: hidden;
      padding: 0;
      margin: 0;
    }
    body {
      position: relative;
    }
    #unity-bg {
      position: fixed;
      inset: 0;
      background-image: url('https://cdn.jsdelivr.net/gh/shayderrr/portsv2@main/dashio/TemplateData/bg.png');
      background-position: center;
      background-repeat: no-repeat;
      background-size: cover;
      z-index: 0;
    }
    #gameContainer {
      position: fixed;
      inset: 0;
      margin: 0;
      padding: 0;
      background: transparent !important;
      z-index: 1;
    }
    #gameContainer canvas {
      position: absolute;
      inset: 0;
      margin: auto;
    }
    #gameContainer canvas[data-pixel-art="true"] {
      image-rendering: optimizeSpeed;
      image-rendering: -webkit-crisp-edges;
      image-rendering: -moz-crisp-edges;
      image-rendering: -o-crisp-edges;
      image-rendering: crisp-edges;
      image-rendering: -webkit-optimize-contrast;
      image-rendering: optimize-contrast;
      image-rendering: pixelated;
      -ms-interpolation-mode: nearest-neighbor;
    }
    .loadingOut {
      width: 250px;
      position: fixed;
      left: 50%;
      top: calc(50% - 8px);
      transform: translate(-50%);
      border: 2px solid white;
      height: 14px;
      z-index: 3;
    }
    .logo-intro {
      position: fixed;
      top: 16px;
      left: 16px;
      width: 120px;
      z-index: 3;
      pointer-events: none;
    }
    .logo-hidden {
      display: none;
    }
    .loading-hidden {
      display: none;
    }
  </style>
</head>
<body>
  <div id="unity-bg"></div>

  <div id="gameContainer">
    <img id="intro-logo" src="https://cdn.jsdelivr.net/gh/shayderrr/portsv2@main/dashio/TemplateData/logo.png" class="logo-intro">
    <div id="loading-bar" class="loadingOut"></div>
    <canvas id="unity-canvas" data-pixel-art=""></canvas>
    <script src="https://cdn.jsdelivr.net/gh/shayderrr/portsv2@main/dashio/Build/TPG_DashParty_V05.loader.js"></script>
    <script>
      var canvas = document.querySelector("#unity-canvas");
      var introLogo = document.getElementById("intro-logo");
      var loadingBar = document.getElementById("loading-bar");

      var dataParts = [
        "https://cdn.jsdelivr.net/gh/shayderrr/portsv2@main/dashio/Build/TPG_DashParty_V05.data.unityweb.part0",
        "https://cdn.jsdelivr.net/gh/shayderrr/portsv2@main/dashio/Build/TPG_DashParty_V05.data.unityweb.part1",
        "https://cdn.jsdelivr.net/gh/shayderrr/portsv2@main/dashio/Build/TPG_DashParty_V05.data.unityweb.part2",
        "https://cdn.jsdelivr.net/gh/shayderrr/portsv2@main/dashio/Build/TPG_DashParty_V05.data.unityweb.part3",
        "https://cdn.jsdelivr.net/gh/shayderrr/portsv2@main/dashio/Build/TPG_DashParty_V05.data.unityweb.part4",
        "https://cdn.jsdelivr.net/gh/shayderrr/portsv2@main/dashio/Build/TPG_DashParty_V05.data.unityweb.part5"
      ];

      var scaleToFit;
      try {
        scaleToFit = !!JSON.parse("");
      } catch (e) {
        scaleToFit = true;
      }

      function progressHandler(progress) {
        var percent = progress * 100 + '%';
        canvas.style.background = 'linear-gradient(to right, white, white ' + percent + ', transparent ' + percent + ', transparent) no-repeat center';
        canvas.style.backgroundSize = '100% 1rem';
        canvas.style.width = '250px';
        canvas.style.position = 'fixed';
        canvas.style.left = '50%';
        canvas.style.transform = 'translate(-50%)';
      }

      function onResize() {
        var container = canvas.parentElement;
        var w;
        var h;
        if (scaleToFit) {
          w = window.innerWidth;
          h = window.innerHeight;
          var r = 1080 / 1920;
          if (w * r > window.innerHeight) {
            w = Math.min(w, Math.ceil(h / r));
          }
          h = Math.floor(w * r);
        } else {
          w = 1920;
          h = 1080;
        }
        container.style.width = canvas.style.width = w + "px";
        container.style.height = canvas.style.height = h + "px";
        container.style.top = "0px";
        container.style.left = "0px";
      }

      async function mergeDataParts(parts) {
        var chunks = [];
        var loadedParts = 0;
        var totalParts = parts.length;
        for (var i = 0; i < parts.length; i++) {
          var response = await fetch(parts[i]);
          var arrayBuffer = await response.arrayBuffer();
          chunks.push(arrayBuffer);
          loadedParts++;
          progressHandler(loadedParts / totalParts * 0.5);
        }
        var totalLength = chunks.reduce(function(acc, chunk) { return acc + chunk.byteLength; }, 0);
        var combined = new Uint8Array(totalLength);
        var offset = 0;
        for (var j = 0; j < chunks.length; j++) {
          combined.set(new Uint8Array(chunks[j]), offset);
          offset += chunks[j].byteLength;
        }
        var blob = new Blob([combined], { type: "application/octet-stream" });
        return URL.createObjectURL(blob);
      }

      async function startGame() {
        var mergedDataUrl = await mergeDataParts(dataParts);
        var config = {
          dataUrl: mergedDataUrl,
          frameworkUrl: "https://cdn.jsdelivr.net/gh/shayderrr/portsv2@main/dashio/Build/TPG_DashParty_V05.framework.js.unityweb",
          codeUrl: "https://cdn.jsdelivr.net/gh/shayderrr/portsv2@main/dashio/Build/TPG_DashParty_V05.wasm.unityweb",
          streamingAssetsUrl: "StreamingAssets",
          companyName: "RHM Interactive",
          productName: "Dash Party",
          productVersion: "1.3.6"
        };
        createUnityInstance(canvas, config, function(progress) {
          progressHandler(0.5 + progress * 0.5);
        }).then(function (instance) {
          canvas = instance.Module.canvas;
          onResize();
          URL.revokeObjectURL(mergedDataUrl);
          introLogo.classList.add("logo-hidden");
          loadingBar.classList.add("loading-hidden");
          canvas.style.background = "transparent";
        });
      }

      window.addEventListener('resize', onResize);
      onResize();
      startGame();
    </script>
  </div>
</body>
</html>
